<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Detecting and correct contamination with SoupX — runSoupX • singleCellTK</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Detecting and correct contamination with SoupX — runSoupX"><meta property="og:description" content="A wrapper function for autoEstCont and 
adjustCounts. Identify potential contamination from 
experimental factors such as ambient RNA. Visit
their vignette
for better understanding."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">singleCellTK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="https://www.camplab.net/sctk" class="external-link">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/console_analysis_tutorial.html">A La Carte Workflow - PBMC3K (R Console)</a>
    </li>
    <li>
      <a href="../articles/cnsl_seurat_curated_workflow.html">Seurat Curated Workflow - PBMC3K</a>
    </li>
    <li>
      <a href="../articles/celda_curated_workflow.html">Celda Curated Workflow - PBMC3K</a>
    </li>
  </ul></li>
<li>
  <a href="../articles/cmd_qc.html">SCTK-QC</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Data</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/import_data.html">Import Data</a>
        </li>
        <li>
          <a href="../articles/import_genesets.html">Import Gene Sets</a>
        </li>
        <li>
          <a href="../articles/import_annotation.html">Annotation</a>
        </li>
        <li>
          <a href="../articles/export_data.html">Export Data</a>
        </li>
        <li>
          <a href="../articles/delete_data.html">Delete Data</a>
        </li>
      </ul></li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">QC &amp; Filtering</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/cnsl_dropletqc.html">Droplet QC (R console)</a>
        </li>
        <li>
          <a href="../articles/cnsl_cellqc.html">Cell QC (R console)</a>
        </li>
        <li>
          <a href="../articles/ui_qc.html">Cell QC (Shiny UI)</a>
        </li>
        <li>
          <a href="../articles/filtering.html">Filtering</a>
        </li>
      </ul></li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Normalization &amp; Batch Correction</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/cnsl_normalization.html">Normalization</a>
        </li>
        <li>
          <a href="../articles/batch_correction.html">Batch Correction</a>
        </li>
      </ul></li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Feature Selection &amp; Dimensionality Reduction</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/cnsl_feature_selection.html">Feature Selection</a>
        </li>
        <li>
          <a href="../articles/cnsl_dimensionality_reduction.html">Dimensionality Reduction</a>
        </li>
        <li>
          <a href="../articles/cnsl_2d_embedding.html">2D Embedding</a>
        </li>
      </ul></li>
    <li>
      <a href="../articles/clustering.html">Clustering</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Differential Expression &amp; Cell Type Labeling</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/differential_expression.html">Differential Expression</a>
        </li>
        <li>
          <a href="../articles/find_marker.html">Find Marker</a>
        </li>
        <li>
          <a href="../articles/cell_type_labeling.html">Cell Type Labeling</a>
        </li>
      </ul></li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Enrichment &amp; Pathway Analysis</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/cnsl_enrichR.html">EnrichR</a>
        </li>
        <li>
          <a href="../articles/pathwayAnalysis.html">Pathway Analysis</a>
        </li>
      </ul></li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Curated Workflows</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/cnsl_seurat_curated_workflow.html">Seurat</a>
        </li>
        <li>
          <a href="../articles/celda_curated_workflow.html">Celda</a>
        </li>
      </ul></li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Visualization</a>
      <ul class="dropdown-menu" role="menu"><li>
          <a href="../articles/visualization.html">General Visualization</a>
        </li>
        <li>
          <a href="../articles/heatmap.html">Generic Heatmap</a>
        </li>
      </ul></li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">NEWS</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/compbiomed/singleCellTK" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/camplab1" class="external-link">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detecting and correct contamination with SoupX</h1>
    <small class="dont-index">Source: <a href="https://github.com/compbiomed/singleCellTK/blob/HEAD/R/runSoupX.R" class="external-link"><code>R/runSoupX.R</code></a></small>
    <div class="hidden name"><code>runSoupX.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A wrapper function for <a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">autoEstCont</a> and 
<a href="https://rdrr.io/pkg/SoupX/man/adjustCounts.html" class="external-link">adjustCounts</a>. Identify potential contamination from 
experimental factors such as ambient RNA. Visit
<a href="https://rawcdn.githack.com/constantAmateur/SoupX/204b602418df12e9fdb4b68775a8b486c6504fe4/inst/doc/pbmcTutorial.html" class="external-link">their vignette</a>
for better understanding.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">runSoupX</span><span class="op">(</span>
  <span class="va">inSCE</span>,
  sample <span class="op">=</span> <span class="cn">NULL</span>,
  useAssay <span class="op">=</span> <span class="st">"counts"</span>,
  background <span class="op">=</span> <span class="cn">NULL</span>,
  bgAssayName <span class="op">=</span> <span class="cn">NULL</span>,
  bgBatch <span class="op">=</span> <span class="cn">NULL</span>,
  assayName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span>, <span class="st">"SoupX"</span>, <span class="st">"SoupX_bg"</span><span class="op">)</span>,
  cluster <span class="op">=</span> <span class="cn">NULL</span>,
  reducedDimName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span>, <span class="st">"SoupX_UMAP_"</span>, <span class="st">"SoupX_bg_UMAP_"</span><span class="op">)</span>,
  tfidfMin <span class="op">=</span> <span class="fl">1</span>,
  soupQuantile <span class="op">=</span> <span class="fl">0.9</span>,
  maxMarkers <span class="op">=</span> <span class="fl">100</span>,
  contaminationRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.8</span><span class="op">)</span>,
  rhoMaxFDR <span class="op">=</span> <span class="fl">0.2</span>,
  priorRho <span class="op">=</span> <span class="fl">0.05</span>,
  priorRhoStdDev <span class="op">=</span> <span class="fl">0.1</span>,
  forceAccept <span class="op">=</span> <span class="cn">FALSE</span>,
  adjustMethod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subtraction"</span>, <span class="st">"soupOnly"</span>, <span class="st">"multinomial"</span><span class="op">)</span>,
  roundToInt <span class="op">=</span> <span class="cn">FALSE</span>,
  tol <span class="op">=</span> <span class="fl">0.001</span>,
  pCut <span class="op">=</span> <span class="fl">0.01</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>inSCE</dt>
<dd><p>A SingleCellExperiment object.</p></dd>
<dt>sample</dt>
<dd><p>A single character specifying a name that can be found in
<code>colData(inSCE)</code> to directly use the cell annotation; or a character
vector with as many elements as cells to indicates which sample each cell
belongs to. SoupX will be run on cells from each sample separately. Default 
<code>NULL</code>.</p></dd>
<dt>useAssay</dt>
<dd><p>A single character string specifying which assay in 
<code>inSCE</code> to use. Default <code>'counts'</code>.</p></dd>
<dt>background</dt>
<dd><p>A numeric matrix of counts or a 
SingleCellExperiment object with the matrix in <code>assay</code> 
slot. It should have the same structure as <code>inSCE</code> except it contains 
the matrix including empty droplets. Default <code>NULL</code>.</p></dd>
<dt>bgAssayName</dt>
<dd><p>A single character string specifying which assay in 
<code>background</code> to use when <code>background</code> is a 
SingleCellExperiment object. If <code>NULL</code>, the function
will use the same value as <code>useAssay</code>. Default <code>NULL</code>.</p></dd>
<dt>bgBatch</dt>
<dd><p>The same thing as <code>sample</code> but for <code>background</code>. Can
be a single character only when <code>background</code> is a 
SingleCellExperiment object. Default <code>NULL</code>.</p></dd>
<dt>assayName</dt>
<dd><p>A single character string of the output corrected matrix. 
Default <code>"SoupX"</code> when not using a background, otherwise, 
<code>"SoupX_bg"</code>.</p></dd>
<dt>cluster</dt>
<dd><p>Prior knowledge of clustering labels on cells. A single 
character string for specifying clustering label stored in 
<code>colData(inSCE)</code>, or a character vector with as many elements as cells.
When not supplied, <code><a href="https://rdrr.io/pkg/scran/man/quickCluster.html" class="external-link">quickCluster</a></code> method will be applied.</p></dd>
<dt>reducedDimName</dt>
<dd><p>A single character string of the prefix of output 
corrected embedding matrix for each sample. Default <code>"SoupX_UMAP_"</code> when 
not using a background, otherwise, <code>"SoupX_bg_UMAP_"</code>.</p></dd>
<dt>tfidfMin</dt>
<dd><p>Numeric. Minimum value of tfidf to accept for a marker gene. 
Default <code>1</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>soupQuantile</dt>
<dd><p>Numeric. Only use genes that are at or above this 
expression quantile in the soup. This prevents inaccurate estimates due to 
using genes with poorly constrained contribution to the background. Default 
<code>0.9</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>maxMarkers</dt>
<dd><p>Integer. If we have heaps of good markers, keep only the 
best maxMarkers of them. Default <code>100</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>contaminationRange</dt>
<dd><p>Numeric vector of two elements. This constrains 
the contamination fraction to lie within this range. Must be between 0 and 1.
The high end of this range is passed to 
<code><a href="https://rdrr.io/pkg/SoupX/man/estimateNonExpressingCells.html" class="external-link">estimateNonExpressingCells</a></code> as 
<code>maximumContamination</code>. Default <code>c(0.01, 0.8)</code>. See 
<code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>rhoMaxFDR</dt>
<dd><p>Numeric. False discovery rate passed to 
<code><a href="https://rdrr.io/pkg/SoupX/man/estimateNonExpressingCells.html" class="external-link">estimateNonExpressingCells</a></code>, to test if rho is less than 
<code>maximumContamination</code>. Default <code>0.2</code>. See 
<code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>priorRho</dt>
<dd><p>Numeric. Mode of gamma distribution prior on contamination 
fraction. Default <code>0.05</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>priorRhoStdDev</dt>
<dd><p>Numeric. Standard deviation of gamma distribution prior 
on contamination fraction. Default <code>0.1</code>. See 
<code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>forceAccept</dt>
<dd><p>Logical. Should we allow very high contamination fractions
to be used. Passed to <code><a href="https://rdrr.io/pkg/SoupX/man/setContaminationFraction.html" class="external-link">setContaminationFraction</a></code>. Default 
<code>FALSE</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/autoEstCont.html" class="external-link">?SoupX::autoEstCont</a></code>.</p></dd>
<dt>adjustMethod</dt>
<dd><p>Character. Method to use for correction. One of 
<code>'subtraction'</code>, <code>'soupOnly'</code>, or <code>'multinomial'</code>. Default 
<code>'subtraction'</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/adjustCounts.html" class="external-link">?SoupX::adjustCounts</a></code>.</p></dd>
<dt>roundToInt</dt>
<dd><p>Logical. Should the resulting matrix be rounded to 
integers? Default <code>FALSE</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/adjustCounts.html" class="external-link">?SoupX::adjustCounts</a></code>.</p></dd>
<dt>tol</dt>
<dd><p>Numeric. Allowed deviation from expected number of soup counts. 
Don't change this. Default <code>0.001</code>. See <code><a href="https://rdrr.io/pkg/SoupX/man/adjustCounts.html" class="external-link">?SoupX::adjustCounts</a></code>.</p></dd>
<dt>pCut</dt>
<dd><p>Numeric. The p-value cut-off used when 
<code>method = 'soupOnly'</code>. Default <code>0.01</code>. See 
<code><a href="https://rdrr.io/pkg/SoupX/man/adjustCounts.html" class="external-link">?SoupX::adjustCounts</a></code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The input <code>inSCE</code> object with <code>soupX_nUMIs</code>, 
<code>soupX_clustrers</code>, <code>soupX_contamination</code> appended to <code>colData</code>slot; <code>soupX_{sample}_est</code> and <code>soupX_{sample}_counts</code> for each 
sample appended to <code>rowData</code> slot; and other computational metrics at 
<code>getSoupX(inSCE)</code>. Replace "soupX" to "soupX_bg" when <code>background</code>is used.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Yichen Wang</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">scExample</span>, package <span class="op">=</span> <span class="st">"singleCellTK"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="subsetSCECols.html">subsetSCECols</a></span><span class="op">(</span><span class="va">sce</span>, colData <span class="op">=</span> <span class="st">"type != 'EmptyDroplet'"</span><span class="op">)</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># SoupX does not work for toy example, </span></span>
<span class="r-in"><span class="co"># can be tested with `sce &lt;- importExampleData("pbmc3k")`</span></span>
<span class="r-in"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">runSoupX</span><span class="op">(</span><span class="va">sce</span>, sample <span class="op">=</span> <span class="st">"sample"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Yichen Wang, Irzam Sarfraz, Rui Hong, Yusuke Koga, Salam Alabdullatif, David Jenkins, Vidya Akavoor, Xinyun Cao, Shruthi Bandyadka, Anastasia Leshchyk, Tyler Faits, Mohammed Muzamil Khan, Zhe Wang, W. Evan Johnson, Joshua David Campbell.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

